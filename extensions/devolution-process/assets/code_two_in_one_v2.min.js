document.addEventListener("DOMContentLoaded",e=>{let t=document.querySelector(".devolution-process-section"),n=document.querySelector(".main-section-container"),s=document.getElementById("check_button_opt");s.addEventListener("click",()=>{t.style.display="none",n.style.display="flex"});let i={};function r(){let e=document.getElementById("progress-bar"),t=document.querySelector(".pending__svg"),n=document.querySelector(".carrier__svg"),s=document.querySelector(".review__svg"),i=document.querySelector(".result__svg");e.style.width="0%",t.classList.contains("done")&&t.classList.remove("done"),n.classList.contains("done")&&n.classList.remove("done"),s.classList.contains("done")&&s.classList.remove("done"),i.classList.contains("done")&&(i.classList.remove("done"),i.innerHTML="")}function a(){let e=document.getElementById("progress-bar"),t=document.querySelector(".pending__svg"),n=document.querySelector(".carrier__svg"),s=document.querySelector(".review__svg"),r=document.querySelector(".result__svg");"Pendiente"==i.status?(e.style.width="0%",t.classList.add("done")):"En camino"==i.status?(e.style.width="33%",t.classList.add("done"),n.classList.add("done")):"En revision"==i.status?(e.style.width="68%",t.classList.add("done"),n.classList.add("done"),s.classList.add("done")):"Rechazado"==i.status?(e.style.width="100%",t.classList.add("done"),n.classList.add("done"),s.classList.add("done"),r.classList.add("done"),r.innerHTML='<svg viewBox="0 -0.5 8 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>close_mini [#1522]</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-385.000000, -206.000000)" fill="#000000"> <g id="icons" transform="translate(56.000000, 160.000000)"> <polygon id="close_mini-[#1522]" points="334.6 49.5 337 51.6 335.4 53 333 50.9 330.6 53 329 51.6 331.4 49.5 329 47.4 330.6 46 333 48.1 335.4 46 337 47.4"> </polygon> </g> </g> </g> </g></svg>'):"Aceptado"==i.status&&(e.style.width="100%",t.classList.add("done"),n.classList.add("done"),s.classList.add("done"),r.classList.add("done"),r.innerHTML='<svg viewBox="0 -1.5 11 11" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>done_mini [#1484]</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-304.000000, -366.000000)" fill="#000000"> <g id="icons" transform="translate(56.000000, 160.000000)"> <polygon id="done_mini-[#1484]" points="259 207.6 252.2317 214 252.2306 213.999 252.2306 214 248 210 249.6918 208.4 252.2306 210.8 257.3082 206"> </polygon> </g> </g> </g> </g></svg>')}async function l(e){r();try{let t=window.location.origin+"/apps/store-return/?id="+e,n=await fetch(t);if(!n.ok)throw Error(`HTTP error! status: ${n.status}`);let s=await n.json();return s.devolution}catch(i){return null}}async function o(){let e=document.getElementById("search-input").value,t=await l(e);""!=e&&null!=t?(i=t,c(),a(),d("result")):d("no-result")}function d(e){let t=document.querySelector(".no-result-found"),n=document.querySelector(".result-container");"result"==e?(n.classList.contains("show")||n.classList.add("show"),t.classList.contains("show")&&t.classList.remove("show")):"no-result"==e&&(t.classList.contains("show")||t.classList.add("show"),n.classList.contains("show")&&n.classList.remove("show"))}function c(){let e=document.getElementById("status-info-label"),t=document.getElementById("status-info-populated"),n=document.getElementById("status-info-commentaries");"Pendiente"==i.status?(e.innerHTML="Pendiente",t.innerHTML="Tu devoluci\xf3n ha sido registrada y se encuentra en proceso de verficaci\xf3n"):"En camino"==i.status?(e.innerHTML="En camino",t.innerHTML="Tu devoluci\xf3n ha pasado el primer filtro y se encuentra en camino a nuestras instalaciones"):"En revision"==i.status?(e.innerHTML="En revision",t.innerHTML="Tu devoluci\xf3n ha llegado a nuestras instalaciones y se encuentra en proceso de revisi\xf3n"):"Rechazado"==i.status?(e.innerHTML="Rechazado",t.innerHTML="Tu devoluci\xf3n ha sido rechazada",n.innerHTML=i.comentarios):"Aceptado"==i.status&&(e.innerHTML="Aceptado",t.innerHTML="Tu devoluci\xf3n ha sido aceptada",""!=i.ndc&""==i.monedero?n.innerHTML=`Tienes una nota de credito <strong class="important-text">#${i.ndc}</strong> con valor de <strong class="important-text">$ ${i.value}</strong>`:""!=i.monedero&""==i.ndc&&(n.innerHTML=`Tienes un monedero <strong class="important-text">#${i.ndc}</strong> con valor de <strong class="important-text">$ ${i.value}</strong>`))}let u=document.getElementById("search-button");u.addEventListener("click",o);let m={subsidiary:"",main_reason:"",explanation:"",ticket_number:"",client_number:"",order_number:"",items:[],date_product_arrived:"",phone_number:"",files:[]};function g(e,t){return""!==e||(alert(`El campo ${t} es obligatorio.`),!1)}function y(){m.subsidiary="",m.main_reason="",m.explanation="",m.ticket_number="",m.client_number="",m.order_number="",m.items=[],m.date_product_arrived="",m.phone_number="",m.files=[],document.getElementById("order-input").value="",document.getElementById("client-number").value="",document.getElementById("reason-input").value="",document.getElementById("sku-input").value="",document.getElementById("qty-input").value="",document.getElementById("phone-number").value="";let e=document.querySelector("#product-table tbody");e.innerHTML=""}function $(e,t){if(2==t){let n=document.getElementById("subsidiary-input").value,s=document.querySelector(".forSubsidiary");"En Linea"!=n?s.style.display="none":s.style.display="block"}document.getElementById(`card-${e}`).classList.remove("show-card"),document.getElementById(`card-${t}`)&&document.getElementById(`card-${t}`).classList.add("show-card")}function p(e){let t=parseInt(e)-1;if(3==e){let n=document.getElementById("subsidiary-input").value;"En Linea"!=n?forSubsidiary.style.display="none":forSubsidiary.style.display="block"}document.getElementById(`card-${e}`).classList.remove("show-card"),document.getElementById(`card-${t}`)&&document.getElementById(`card-${t}`).classList.add("show-card")}function h(e){y();let t=document.getElementById("folio-number");t.innerHTML=e.id,$(3,4)}function f(){document.querySelector(".sucess-info").classList.contains("show-result-info")&&document.querySelector(".sucess-info").classList.remove("show-result-info"),document.querySelector(".error-info").classList.contains("show-result-info")&&document.querySelector(".error-info").classList.remove("show-result-info");let e=window.location.origin+"/apps/store-return/";document.getElementById("loading-spinner").style.display="block",console.log(m),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(e=>e.json()).then(e=>{document.getElementById("loading-spinner").style.display="none",document.querySelector(".sucess-info").classList.add("show-result-info"),h(e.devolution)}).catch(e=>{console.error("Error:",e),document.getElementById("loading-spinner").style.display="none",document.querySelector(".error-info").classList.add("show-result-info"),$(3,4)})}let v=document.querySelectorAll(".card"),L=document.querySelectorAll("#next-card"),E=document.querySelectorAll("#previus-card");v[0].classList.add("show-card");let w=document.getElementById("file-input"),b=document.getElementById("upload-button"),k=document.getElementById("file-list"),I=[],B=e=>{let t=document.createElement("p");return t.classList.add("file-item"),t.textContent=e,t},_=()=>{k.innerHTML="",I.forEach(e=>k.appendChild(B(e.name)))},S=async()=>{I=await Promise.all(Array.from(w.files).map(async e=>({arrayBuffer:btoa(String.fromCharCode(...new Uint8Array(await e.arrayBuffer()))),name:e.name}))),_()},T=e=>{e.forEach(({elementId:e,key:t,label:n})=>{let s=document.getElementById(e).value;if(g(s,n))m[t]=s;else throw Error(`Validation failed for field: ${n}`)})};function q(){return!(m.items.length<=0)||(alert(`No has agregado ningun item para garant\xeda`),!1)}b.addEventListener("click",()=>w.click()),w.addEventListener("change",S),L.forEach(e=>{e.addEventListener("click",function(){let e=parseInt(this.getAttribute("data-card")),t=e+1;try{switch(e){case 1:T([{elementId:"ticket-input",key:"ticket_number",label:"N\xfamero de Ticket"},{elementId:"phone-number",key:"phone_number",label:"N\xfamero de Tel\xe9fono"},{elementId:"subsidiary-input",key:"subsidiary",label:"Sucursal"}]),$(e,t);break;case 2:T([{elementId:"reason-input",key:"main_reason",label:"Motivo de Devoluci\xf3n"},{elementId:"client-number",key:"client_number",label:"N\xfamero de Cliente"},{elementId:"commentaries",key:"explanation",label:"Explicaci\xf3n"},{elementId:"date-input",key:"date_product_arrived",label:"Fecha de llegada"}]),m.order_number=document.getElementById("order-input").value,m.files=I,$(e,t);break;case 3:q()&&f()}}catch(n){console.error(n.message)}})}),E.forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-card");p(e)})});let x=document.getElementById("add-product-button"),C=document.getElementById("sku-input"),M=document.getElementById("qty-input"),H=document.querySelector("#product-table tbody");x.addEventListener("click",()=>{let e=C.value,t=Number(M.value);if(g(e,"SKU")&&g(t,"Cantidad")){let n=m.items.findIndex(t=>t.sku==e);if(-1!=n){m.items[n].cantidad+=t;let s=H.getElementsByTagName("tr");for(let i of s){let r=i.getElementsByTagName("td")[0];if(r.textContent==e){let a=i.getElementsByTagName("td")[1];a.textContent=m.items[n].cantidad;break}}C.value="",M.value=""}else{m.items.push({sku:e,cantidad:t});let l=document.createElement("tr"),o=document.createElement("td");o.textContent=e;let d=document.createElement("td");d.textContent=t,l.appendChild(o),l.appendChild(d),H.appendChild(l),C.value="",M.value=""}}});let A=document.querySelectorAll(".tooltip");A.forEach(e=>{e.addEventListener("click",()=>{let t=e.querySelector(".tooltiptext");t.classList.contains("show-tooltip")?t.classList.remove("show-tooltip"):t.classList.add("show-tooltip")})}),console.log("All in One")});