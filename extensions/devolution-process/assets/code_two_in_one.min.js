document.addEventListener("DOMContentLoaded",e=>{let t=document.querySelector(".devolution-process-section"),n=document.querySelector(".main-section-container"),s=document.getElementById("check_button_opt");s.addEventListener("click",()=>{t.style.display="none",n.style.display="flex"});let i={};function r(){let e=document.getElementById("progress-bar"),t=document.querySelector(".pending__svg"),n=document.querySelector(".carrier__svg"),s=document.querySelector(".review__svg"),i=document.querySelector(".result__svg");e.style.width="0%",t.classList.contains("done")&&t.classList.remove("done"),n.classList.contains("done")&&n.classList.remove("done"),s.classList.contains("done")&&s.classList.remove("done"),i.classList.contains("done")&&(i.classList.remove("done"),i.innerHTML="")}function o(){let e=document.getElementById("progress-bar"),t=document.querySelector(".pending__svg"),n=document.querySelector(".carrier__svg"),s=document.querySelector(".review__svg"),r=document.querySelector(".result__svg");"Pendiente"==i.status?(e.style.width="0%",t.classList.add("done")):"En camino"==i.status?(e.style.width="33%",t.classList.add("done"),n.classList.add("done")):"En revision"==i.status?(e.style.width="68%",t.classList.add("done"),n.classList.add("done"),s.classList.add("done")):"Rechazado"==i.status?(e.style.width="100%",t.classList.add("done"),n.classList.add("done"),s.classList.add("done"),r.classList.add("done"),r.innerHTML='<svg viewBox="0 -0.5 8 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>close_mini [#1522]</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-385.000000, -206.000000)" fill="#000000"> <g id="icons" transform="translate(56.000000, 160.000000)"> <polygon id="close_mini-[#1522]" points="334.6 49.5 337 51.6 335.4 53 333 50.9 330.6 53 329 51.6 331.4 49.5 329 47.4 330.6 46 333 48.1 335.4 46 337 47.4"> </polygon> </g> </g> </g> </g></svg>'):"Aceptado"==i.status&&(e.style.width="100%",t.classList.add("done"),n.classList.add("done"),s.classList.add("done"),r.classList.add("done"),r.innerHTML='<svg viewBox="0 -1.5 11 11" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>done_mini [#1484]</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-304.000000, -366.000000)" fill="#000000"> <g id="icons" transform="translate(56.000000, 160.000000)"> <polygon id="done_mini-[#1484]" points="259 207.6 252.2317 214 252.2306 213.999 252.2306 214 248 210 249.6918 208.4 252.2306 210.8 257.3082 206"> </polygon> </g> </g> </g> </g></svg>')}async function a(e){r();try{let t=window.location.origin+"/apps/store-return/?id="+e,n=await fetch(t);if(!n.ok)throw Error(`HTTP error! status: ${n.status}`);let s=await n.json();return s.devolution}catch(i){return null}}async function l(){let e=document.getElementById("search-input").value,t=await a(e);""!=e&&null!=t?(i=t,c(),o(),d("result")):d("no-result")}function d(e){let t=document.querySelector(".no-result-found"),n=document.querySelector(".result-container");"result"==e?(n.classList.contains("show")||n.classList.add("show"),t.classList.contains("show")&&t.classList.remove("show")):"no-result"==e&&(t.classList.contains("show")||t.classList.add("show"),n.classList.contains("show")&&n.classList.remove("show"))}function c(){let e=document.getElementById("status-info-label"),t=document.getElementById("status-info-populated"),n=document.getElementById("status-info-commentaries");"Pendiente"==i.status?(e.innerHTML="Pendiente",t.innerHTML="Tu devoluci\xf3n ha sido registrada y se encuentra en proceso de verficaci\xf3n"):"En camino"==i.status?(e.innerHTML="En camino",t.innerHTML="Tu devoluci\xf3n ha pasado el primer filtro y se encuentra en camino a nuestras instalaciones"):"En revision"==i.status?(e.innerHTML="En revision",t.innerHTML="Tu devoluci\xf3n ha llegado a nuestras instalaciones y se encuentra en proceso de revisi\xf3n"):"Rechazado"==i.status?(e.innerHTML="Rechazado",t.innerHTML="Tu devoluci\xf3n ha sido rechazada",n.innerHTML=i.comentarios):"Aceptado"==i.status&&(e.innerHTML="Aceptado",t.innerHTML="Tu devoluci\xf3n ha sido aceptada",""!=i.ndc&""==i.monedero?n.innerHTML=`Tienes una nota de credito <strong class="important-text">#${i.ndc}</strong> con valor de <strong class="important-text">$ ${i.value}</strong>`:""!=i.monedero&""==i.ndc&&(n.innerHTML=`Tienes un monedero <strong class="important-text">#${i.ndc}</strong> con valor de <strong class="important-text">$ ${i.value}</strong>`))}let u=document.getElementById("search-button");u.addEventListener("click",l);let m={subsidiary:"",main_reason:"",explanation:"",ticket_number:"",client_number:"",order_number:"",items:[],date_product_arrived:"",phone_number:""};function g(e,t){return""!==e||(alert(`El campo ${t} es obligatorio.`),!1)}function y(){m.subsidiary="",m.main_reason="",m.explanation="",m.ticket_number="",m.client_number="",m.order_number="",m.items=[],m.date_product_arrived="",m.phone_number="",document.getElementById("ticket-input").value="",document.getElementById("order-input").value="",document.getElementById("client-number").value="",document.getElementById("reason-input").value="",document.getElementById("subsidiary-input").value="",document.getElementById("commentaries").value="",document.getElementById("date-input").value="",document.getElementById("sku-input").value="",document.getElementById("qty-input").value="",document.getElementById("phone-number").value="";let e=document.querySelector("#product-table tbody");e.innerHTML=""}function p(e,t){if(document.getElementById(`card-${e}`).classList.remove("show-card"),2==t){let n=document.getElementById("subsidiary-input").value,s=document.getElementById("date-arrived-label");"En Linea"!=n?(document.querySelector(".forSubsidiary").style.display="none",s.innerHTML="Fecha en que recibiste el producto"):(document.querySelector(".forSubsidiary").style.display="block",s.innerHTML="Fecha en que adquiriste el producto")}document.getElementById(`card-${t}`)&&document.getElementById(`card-${t}`).classList.add("show-card")}function $(e){let t=parseInt(e)-1;if(2==t){let n=document.getElementById("subsidiary-input").value,s=document.getElementById("date-arrived-label");"En Linea"!=n?(document.querySelector(".forSubsidiary").style.display="none",s.innerHTML="Fecha en que recibiste el producto"):(document.querySelector(".forSubsidiary").style.display="block",s.innerHTML="Fecha en que adquiriste el producto")}document.getElementById(`card-${e}`).classList.remove("show-card"),document.getElementById(`card-${t}`)&&document.getElementById(`card-${t}`).classList.add("show-card")}function v(e){y();let t=document.getElementById("folio-number");t.innerHTML=e.id;let n=document.getElementById("whatsapp-anchor"),s=`https://api.whatsapp.com/send?phone=522211939333&text=Genere un nuevo ticket, por *${e.mainReason}* y mi compra la realice en *PT${e.sucursal}*. Mi n\xfamero de folio es *${e.id}*.`;n.href=s,p(3,4)}function h(){document.querySelector(".sucess-info").classList.contains("show-result-info")&&document.querySelector(".sucess-info").classList.remove("show-result-info"),document.querySelector(".error-info").classList.contains("show-result-info")&&document.querySelector(".error-info").classList.remove("show-result-info");let e=window.location.origin+"/apps/store-return/";document.getElementById("loading-spinner").style.display="block",console.log(m),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(e=>e.json()).then(e=>{document.getElementById("loading-spinner").style.display="none",document.querySelector(".sucess-info").classList.add("show-result-info"),v(e.devolution)}).catch(e=>{console.error("Error:",e),document.getElementById("loading-spinner").style.display="none",document.querySelector(".error-info").classList.add("show-result-info"),p(3,4)})}let L=document.querySelectorAll(".card"),f=document.querySelectorAll("#next-card"),E=document.querySelectorAll("#previus-card");function w(){return!(m.items.length<=0)||(alert(`No has agregado ningun item para garant\xeda`),!1)}L[0].classList.add("show-card"),f.forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-card"),t=parseInt(e)+1;switch(e){case"1":let n=document.getElementById("ticket-input").value,s=document.getElementById("phone-number").value,i=document.getElementById("subsidiary-input").value;g(n,"N\xfamero de Ticket")&&g(s,"N\xfamero de Tel\xe9fono")&&g(i,"Lugar de Compra")&&(m.ticket_number=n,m.phone_number=s,m.subsidiary=i),p(e,t);break;case"2":let r=document.getElementById("subsidiary-input").value,o=document.getElementById("order-input").value;m.explanation=document.getElementById("commentaries").value;let a=document.getElementById("date-input").value,l=document.getElementById("reason-input").value,d=document.getElementById("client-number").value;if("En Linea"==r){if(g(o,"N\xfamero de Orden"))m.order_number=o;else break}g(d,"N\xfamero de Cliente")&&g(l,"Motivo de Devoluci\xf3n")&&g(a,"Fecha de Recepci\xf3n del Producto")&&(m.client_number=d,m.main_reason=l,m.date_product_arrived=a+" 00:00:00.000",p(e,t));break;case"3":w()&&h()}})}),E.forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-card");$(e)})});let b=document.getElementById("add-product-button"),B=document.getElementById("sku-input"),I=document.getElementById("qty-input"),S=document.querySelector("#product-table tbody");b.addEventListener("click",()=>{let e=B.value,t=Number(I.value);if(g(e,"SKU")&&g(t,"Cantidad")){let n=m.items.findIndex(t=>t.sku==e);if(-1!=n){m.items[n].cantidad+=t;let s=S.getElementsByTagName("tr");for(let i of s){let r=i.getElementsByTagName("td")[0];if(r.textContent==e){let o=i.getElementsByTagName("td")[1];o.textContent=m.items[n].cantidad;break}}B.value="",I.value=""}else{m.items.push({sku:e,cantidad:t});let a=document.createElement("tr"),l=document.createElement("td");l.textContent=e;let d=document.createElement("td");d.textContent=t,a.appendChild(l),a.appendChild(d),S.appendChild(a),B.value="",I.value=""}}});let _=document.querySelectorAll(".tooltip");_.forEach(e=>{e.addEventListener("click",()=>{let t=e.querySelector(".tooltiptext");t.classList.contains("show-tooltip")?t.classList.remove("show-tooltip"):t.classList.add("show-tooltip")})})});